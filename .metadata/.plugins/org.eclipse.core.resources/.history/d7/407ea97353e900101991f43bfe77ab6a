package cl.automind.empathy.fw.data;

import java.util.Hashtable;
import java.util.Map;

import cl.automind.empathy.data.AbstractDataManager;
import cl.automind.empathy.data.IDataSource;

import patterns.creational.FlyweightNamedFactory;

public class DefaultDataManager extends AbstractDataManager{
	
	private final FlyweightNamedFactory<IDataSource<?>> dataSources;
	public DefaultDataManager(){
		dataSources = new FlyweightNamedFactory<IDataSource<?>>() {
			@Override
			public Map<String, IDataSource<?>> initializeMap() {
				return new Hashtable<String, IDataSource<?>>();
			}
		};
	}
	@Override
	public boolean createSpaceIfNotFound() {
		return true;
	}
	@Override
	public <T> IDataSource<T> getDataSource(String dataSourceName) {
	IDataSource<T> space = (IDataSource<T>) dataSources.createElement(dataSourceName);
		if (space == null && createSpaceIfNotFound()){
			space = new InternalDataSource<T>(true);
			dataSources.registerElement(dataSourceName, space);
		}
		return space;
	}
	@Override
	public <T> IDataSource<T> getDataSource(String DataSourceName, T template) {
		IDataSource<T> space = (IDataSource<T>) dataSources.createElement(DataSourceName);
		if (space == null && createSpaceIfNotFound()){
			space = new InternalDataSource<T>(true);
			dataSources.registerElement(DataSourceName, space);
		}
		return space;
	}
	
	@Override
	public void onSuscription(IDataSource data) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void onNew(IDataSource data) {
		// TODO Auto-generated method stub
		
	}

	@Override
	public void onCompletition() {
		// TODO Auto-generated method stub
		
	}
	@Override
	public <T> boolean registerDataSource(String dataSourceName, IDataSource<T> DataSource) {
		if (!dataSources.elementRegistered(dataSourceName)){
			dataSources.registerElement(dataSourceName, DataSource);
			return true;
		}
		return false;
	}

}
