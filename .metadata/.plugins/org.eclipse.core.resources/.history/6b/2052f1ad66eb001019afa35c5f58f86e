package cl.automind.vote.android.empathy;

import java.util.List;

import cl.automind.empathy.feedback.AbstractMessage;
import cl.automind.empathy.rule.AbstractRule;
import cl.automind.vote.android.Score;

public class FirstScoreRule extends AbstractRule {

	@Override
	public double evaluateImpl() {
		int total = 0;
		List<Score> scores = getAllInSource(EmpathicConstants.DS_SCORES, EmpathicConstants.TP_SCORE);
		for (int i = scores.size() - 1; i >= 0; i--){
			if (scores.get(i).getValue() > 0) total++;
			else break;
		}
		if (total > 0) {
			clearValues();
			putValue(STREAK, total);
		}
		return total;
	}

	@Override
	public boolean canEvaluate(Object... params) {
		return countAllInSource(EmpathicConstants.DS_SCORES) < 2;
	}

	public class FirstRuleMessage extends AbstractMessage{

		@Override
		public String getName() {
			return "mFirstScore00";
		}

		@Override
		public String getEmotionName() {
			return "happiness";
		}

		@Override
		public String getUnfilteredText() {
			return "Acabas de contestar @result tu primera pregunta!!!";
		}
	}
}
