package cl.automind.empathy.testquery;

import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.util.ArrayList;
import java.util.Collection;
import java.util.List;

import cl.automind.empathy.data.sql.ISqlConnector;
import cl.automind.empathy.data.sql.Sql;
import cl.automind.empathy.data.sql.SqlNamedValuePair;
import cl.automind.empathy.fw.data.sql.AbstractSqlDataSource;

public class EmpathySqlDataSource extends AbstractSqlDataSource<EmpathyMetadata>{

	public EmpathySqlDataSource(EmpathyMetadata template, ISqlConnector connector) {
		super(template, connector);
	}

	@Override
	public List<EmpathyMetadata> parse(ResultSet rs) {
		List<EmpathyMetadata> list = new ArrayList<EmpathyMetadata>();
		try {
			ResultSetMetaData metadata = rs.getMetaData();
			int columns =  metadata.getColumnCount();
			while (rs.next()){
				EmpathyMetadata sagdeMetadata = new EmpathyMetadata();
				for (int i = 1; i <= columns; i++){
					if (metadata.getColumnName(i).equals("id")){
						sagdeMetadata.setId(rs.getInt(i));
					} else if (metadata.getColumnName(i).equals("idsource")){
						sagdeMetadata.setIdsource(rs.getInt(i));
					} else if (metadata.getColumnName(i).equals("idtype")){
						sagdeMetadata.setIdtype(rs.getInt(i));
					} else if (metadata.getColumnName(i).equals("evaluated")){
						sagdeMetadata.setEvaluated(rs.getBoolean(i));
					} else if (metadata.getColumnName(i).equals("answered")){
						sagdeMetadata.setAnswered(rs.getBoolean(i));
					} else if (metadata.getColumnName(i).equals("liked")){
						sagdeMetadata.setLiked(rs.getBoolean(i));
					}
				}
				list.add(sagdeMetadata);
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}
		return list;
	}

	@Override
	public Collection<SqlNamedValuePair<?>> toPairs(EmpathyMetadata target) {
		Collection<SqlNamedValuePair<?>> pairs = new ArrayList<SqlNamedValuePair<?>>();
		pairs.add(Sql.pair("idsector", target.getIdSector()));
		pairs.add(Sql.pair("ideje", target.getIdAxis()));
		pairs.add(Sql.pair("idcmo", target.getIdCmo()));
		pairs.add(Sql.pair("idobjcon", target.getIdKo()));
		pairs.add(Sql.pair("idnivel", target.getIdLevel()));
		pairs.add(Sql.pair("idempathy", target.getIdEmpathy()));
		return pairs;
	}

}
